<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Inventory App</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Sarabun', sans-serif;
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      background: #f5f7fa;
    }
    .page {
      display: none;
      padding: 20px;
    }
    .active {
      display: block;
    }
    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    button {
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 10px;
      background-color: #007bff;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    .summary-table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    .summary-table th, .summary-table td {
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }
    .input-small {
      width: 60px;
    }
  </style>
</head>
<body>

<!-- Main Page -->
<div id="main" class="page active center">
  <h1>Smart Inventory</h1>
  <button onclick="showPage('customer')">Customer</button>
  <button onclick="adminLogin()">Admin</button>
</div>

<!-- Customer Page -->
<div id="customer" class="page">
  <h2>Scan the product</h2>
  <button onclick="startScan()">Scan NFC</button>
  <table class="summary-table" id="summaryTable">
    <thead>
      <tr><th>Product</th><th>Quantity</th><th>Price</th><th>Edit</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="submitOrder()">Submit Order</button>
  <button onclick="showPage('main')">Back</button>
</div>

<!-- Admin Page -->
<div id="admin" class="page">
  <h2>Admin Panel</h2>
  <table class="summary-table">
    <thead>
      <tr><th>Product</th><th>Stock</th><th>+ / -</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>Cleanser</td>
        <td id="stock-Cleanser">0</td>
        <td>
          <button onclick="editStock('Cleanser', 1)">+</button>
          <button onclick="editStock('Cleanser', -1)">-</button>
        </td>
      </tr>
      <tr>
        <td>Toner</td>
        <td id="stock-Toner">0</td>
        <td>
          <button onclick="editStock('Toner', 1)">+</button>
          <button onclick="editStock('Toner', -1)">-</button>
        </td>
      </tr>
      <tr>
        <td>Serum</td>
        <td id="stock-Serum">0</td>
        <td>
          <button onclick="editStock('Serum', 1)">+</button>
          <button onclick="editStock('Serum', -1)">-</button>
        </td>
      </tr>
    </tbody>
  </table>
  <button onclick="showPage('server')">Server</button>
  <button onclick="showPage('main')">Back</button>
</div>

<!-- Server Page -->
<div id="server" class="page">
  <h2>Server Logs</h2>
  <pre id="logOutput" style="background:#eee;padding:10px;border-radius:8px;max-height:300px;overflow:auto;"></pre>
  <button onclick="showPage('admin')">Back to Admin</button>
</div>

<script>
  const productMap = {
    "04A11F89320289": { name: "Cleanser", price: 10 },
    "04F1458B320289": { name: "Toner", price: 15 },
    "04816B94320289": { name: "Serum", price: 20 },
  };

  let stock = {
    "Cleanser": 0,
    "Toner": 0,
    "Serum": 0
  };

  let orderSummary = {};
  let logs = [];

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if (id === 'server') renderLogs();
    if (id === 'admin') renderStock();
    if (id === 'customer') renderSummary();
  }

  function adminLogin() {
    const pass = prompt("Enter Admin Passcode:");
    if (pass === "12345") showPage('admin');
    else alert("Incorrect passcode.");
  }

  function startScan() {
    if ('NDEFReader' in window) {
      const reader = new NDEFReader();
      reader.scan().then(() => {
        reader.onreading = event => {
          const id = Array.from(event.serialNumber).map(x => x.charCodeAt(0).toString(16).padStart(2, '0')).join('').toUpperCase();
          const realID = event.serialNumber.toUpperCase();
          handleNFCScan(realID);
        };
      }).catch(err => alert("NFC Scan Failed: " + err));
    } else {
      alert("Web NFC is not supported on this browser/device.");
    }
  }

  function handleNFCScan(id) {
    const product = productMap[id];
    if (!product) {
      alert("Unrecognized NFC Tag");
      return;
    }

    const qty = parseInt(prompt(`How many ${product.name}?`));
    if (!qty || qty < 1) return;

    if (!orderSummary[product.name]) orderSummary[product.name] = 0;
    orderSummary[product.name] += qty;

    renderSummary();
  }

  function renderSummary() {
    const tbody = document.querySelector("#summaryTable tbody");
    tbody.innerHTML = "";
    Object.entries(orderSummary).forEach(([product, qty]) => {
      const price = productMap[Object.keys(productMap).find(k => productMap[k].name === product)].price;
      tbody.innerHTML += `
        <tr>
          <td>${product}</td>
          <td><input class="input-small" type="number" value="${qty}" onchange="updateQty('${product}', this.value)"/></td>
          <td>à¸¿${price * qty}</td>
          <td><button onclick="removeProduct('${product}')">Remove</button></td>
        </tr>
      `;
    });
  }

  function updateQty(product, value) {
    orderSummary[product] = parseInt(value);
    renderSummary();
  }

  function removeProduct(product) {
    delete orderSummary[product];
    renderSummary();
  }

  function submitOrder() {
    const timestamp = new Date().toLocaleString();
    Object.entries(orderSummary).forEach(([product, qty]) => {
      stock[product] -= qty;
      logs.push(`[ORDER] ${timestamp}: ${qty} x ${product}`);
    });
    orderSummary = {};
    alert("Order Submitted!");
    renderSummary();
  }

  function editStock(product, delta) {
    stock[product] += delta;
    if (stock[product] < 0) stock[product] = 0;
    logs.push(`[STOCK] ${new Date().toLocaleString()}: ${delta > 0 ? "Added" : "Removed"} ${Math.abs(delta)} x ${product}`);
    renderStock();
  }

  function renderStock() {
    for (let product in stock) {
      document.getElementById(`stock-${product}`).textContent = stock[product];
    }
  }

  function renderLogs() {
    document.getElementById("logOutput").textContent = logs.join('\n');
  }
</script>
</body>
</html>
